# Fund Investment Assistant - Backend Server

è¿™æ˜¯åŸºé‡‘æŠ•èµ„åŠ©æ‰‹é¡¹ç›®çš„ **Python åç«¯æœåŠ¡**ã€‚å®ƒä½¿ç”¨ FastAPI, SQLAlchemy å’Œ Typer æ„å»ºï¼Œè´Ÿè´£æ‰€æœ‰æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€æ•°æ®å¤„ç†å’Œ API æœåŠ¡ã€‚

è¯¥é¡¹ç›®ä»¥**æŒæœ‰ä»½é¢**ä¸ºæ ¸å¿ƒï¼Œèƒ½å¤ŸåŠ¨æ€è¿½è¸ªèµ„äº§ä»·å€¼ï¼Œæä¾›å®æ—¶çš„ç›˜ä¸­ä¼°ç®—ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

-   **ä»½é¢æ ¸å¿ƒåˆ¶**: ç”¨æˆ·é€šè¿‡è¾“å…¥ä¹°å…¥é‡‘é¢æ¥å»ºç«‹æŒä»“ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ®å½“æ—¥å‡€å€¼è®¡ç®—å¹¶è®°å½•**æŒæœ‰ä»½é¢**ã€‚åç»­æ‰€æœ‰èµ„äº§ä»·å€¼å‡åŸºäºæ­¤ä»½é¢åŠ¨æ€è®¡ç®—ã€‚
-   **åŠ¨æ€èµ„äº§è¿½è¸ª**:
    -   **æ¯æ—¥æ ¡å‡†**: æ¯æ—¥è‡ªåŠ¨è·å–æœ€æ–°åŸºé‡‘å‡€å€¼ï¼Œå¹¶ç”¨ `ä»½é¢ Ã— æœ€æ–°å‡€å€¼` çš„æ–¹å¼æ›´æ–°æ‚¨çš„**æŒæœ‰é‡‘é¢**ï¼Œç¡®ä¿å…¶åæ˜ çœŸå®èµ„äº§ä»·å€¼ã€‚
    -   **ç›˜ä¸­ä¼°ç®—**: åœ¨äº¤æ˜“æ—¶æ®µå†…ï¼Œå®šæ—¶è·å–å®æ—¶ä¼°å€¼ï¼ŒåŠ¨æ€è®¡ç®—å¹¶æ›´æ–°**é¢„ä¼°é‡‘é¢**ã€**é¢„ä¼°æ¶¨è·Œå¹…**å’Œ**ä¼°å€¼æ›´æ–°æ—¶é—´**ã€‚
-   **RESTful API**: æä¾›ä¸€å¥—å®Œæ•´çš„ APIï¼Œç”¨äºæŒä»“ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰å’Œå¸¦æœ‰çµæ´»å‡çº¿é€‰é¡¹çš„å†å²æ•°æ®æŸ¥è¯¢ã€‚
-   **å‘½ä»¤è¡Œå·¥å…· (CLI)**: æä¾›äº†ä¸€å¥—åŠŸèƒ½å¯¹ç­‰çš„ç®¡ç†å‘½ä»¤ï¼Œæ–¹ä¾¿åœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œæ•°æ®å¯¼å…¥å¯¼å‡ºã€æ‰‹åŠ¨åŒæ­¥ã€æŒä»“ç®¡ç†ç­‰æ‰€æœ‰æ“ä½œã€‚
-   **æ•°æ®å¯¼å…¥/å¯¼å‡º**: æ”¯æŒé€šè¿‡ JSON æ–‡ä»¶å¤‡ä»½å’Œæ¢å¤æ ¸å¿ƒçš„æŒä»“æ•°æ®ï¼ˆåŸºé‡‘ä»£ç å’Œä»½é¢ï¼‰ã€‚
-   **æ•°æ®åº“æ”¯æŒ**: ä½¿ç”¨ PostgreSQLï¼Œå¹¶æ”¯æŒè‡ªå®šä¹‰ Schema è¿›è¡Œæ•°æ®éš”ç¦»ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

-   **Web æ¡†æ¶**: FastAPI
-   **å‘½ä»¤è¡Œæ¡†æ¶**: Typer
-   **æ•°æ®åº“ ORM**: SQLAlchemy
-   **æ•°æ®åº“**: PostgreSQL
-   **é¡¹ç›®ç®¡ç†**: uv (æ›¿ä»£ pip å’Œ venv)
-   **å®šæ—¶ä»»åŠ¡**: Schedule
-   **HTTP å®¢æˆ·ç«¯**: httpx

## ğŸš€ æœ¬åœ°å¼€å‘ç¯å¢ƒè®¾ç½®

### 1. ç¯å¢ƒå‡†å¤‡

-   **å®‰è£… uv**:
    ```bash
    # macOS / Linux
    curl -LsSf https://astral.sh/uv/install.sh | sh
    ```
-   **å®‰è£… PostgreSQL**: ç¡®ä¿æœ¬åœ°å·²å®‰è£…å¹¶è¿è¡Œ PostgreSQL æœåŠ¡ã€‚
-   **åˆ›å»ºæ•°æ®åº“**:
    ```sql
    CREATE DATABASE fund_assistant;
    ```

### 2. é¡¹ç›®é…ç½®

-   **åˆ›å»º `.env` æ–‡ä»¶**: åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `.env` çš„æ–‡ä»¶ï¼Œå¹¶å¡«å…¥æ‚¨çš„æœ¬åœ°æ•°æ®åº“é…ç½®ã€‚
    ```dotenv
    # .env
    DATABASE_URL="postgresql://your_user:your_password@localhost:5432/fund_assistant"
    DB_SCHEMA="fund_app"
    ```

### 3. å®‰è£…ä¸è¿è¡Œ

-   **åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ**:
    ```bash
    uv venv
    source .venv/bin/activate
    ```
-   **å®‰è£…é¡¹ç›®ä¾èµ–**:
    ```bash
    uv sync
    ```
-   **å¯åŠ¨ API åŠå®šæ—¶ä»»åŠ¡æœåŠ¡**:
    ```bash
    uvicorn src.python_cli_starter.main:api_app --reload
    ```
    æœåŠ¡å¯åŠ¨åï¼Œå®šæ—¶ä»»åŠ¡ä¼šè‡ªåŠ¨åœ¨åå°è¿è¡Œã€‚æ‚¨å¯ä»¥åœ¨ `http://127.0.0.1:8888/docs` æŸ¥çœ‹ API æ–‡æ¡£ã€‚

---

## âŒ¨ï¸ å‘½ä»¤è¡Œ (CLI) ç”¨æ³•

æ‰€æœ‰å‘½ä»¤éƒ½é€šè¿‡ `uv run cli` æ‰§è¡Œï¼Œæ— éœ€æ‰‹åŠ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒã€‚

-   **æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤**:
    ```bash
    uv run cli --help
    ```

### æŸ¥çœ‹æŒä»“

ä»¥ç¾è§‚çš„è¡¨æ ¼å½¢å¼åˆ—å‡ºæ‰€æœ‰æŒä»“åŸºé‡‘åŠå…¶é¢„ä¼°ç›ˆäºã€‚
```bash
uv run cli list-holdings
```

### æ·»åŠ æ–°çš„æŒä»“
å½“æ‚¨æ·»åŠ ä¸€ç¬”æŠ•èµ„æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ®æ‚¨è¾“å…¥çš„é‡‘é¢å’Œå½“æ—¶çš„åŸºé‡‘å‡€å€¼ï¼Œè‡ªåŠ¨è®¡ç®—å‡ºæ‚¨æŒæœ‰çš„**ä»½é¢**ã€‚
```bash
# ç¤ºä¾‹ï¼šæŠ•èµ„ 5000 å…ƒåˆ°ä¸€åªåŸºé‡‘
uv run cli add-holding --code "161725" --amount 5000
```
-   `--code` / `-c`: åŸºé‡‘ä»£ç  (**å¿…å¡«**)
-   `--amount` / `-a`: **ä¹°å…¥**é‡‘é¢ (**å¿…å¡«**)
-   `--name` / `-n`: åŸºé‡‘åç§° (å¯é€‰, ç¨‹åºä¼šè‡ªåŠ¨è·å–)

### æ›´æ–°æŒä»“é‡‘é¢
æ­¤æ“ä½œä¼šè°ƒæ•´æ‚¨çš„æ€»èµ„äº§è‡³æ–°æŒ‡å®šçš„é‡‘é¢ï¼Œå¹¶æ ¹æ®æœ€æ–°çš„åŸºé‡‘å‡€å€¼**é‡æ–°è®¡ç®—æ‚¨çš„æ€»ä»½é¢**ã€‚
```bash
# ç¤ºä¾‹ï¼šå°†ä»£ç ä¸º 161725 çš„åŸºé‡‘æ€»èµ„äº§è°ƒæ•´ä¸º 6500 å…ƒ
uv run cli update-holding --code "161725" --amount 6500
```
-   `--code` / `-c`: è¦æ›´æ–°çš„åŸºé‡‘ä»£ç  (**å¿…å¡«**)
-   `--amount` / `-a`: **æ–°çš„æ€»**æŒæœ‰é‡‘é¢ (**å¿…å¡«**)

### åˆ é™¤æŒä»“è®°å½•
æ­¤æ“ä½œä¼šè¿›è¡Œäº¤äº’å¼ç¡®è®¤ï¼Œé˜²æ­¢è¯¯åˆ ã€‚
```bash
# ç¤ºä¾‹ï¼šåˆ é™¤ä»£ç ä¸º 161725 çš„åŸºé‡‘
uv run cli delete-holding 161725
```
> è¦è·³è¿‡ç¡®è®¤ï¼Œå¯æ·»åŠ  `--force` æˆ– `-f` æ ‡å¿—ã€‚

### æ‰‹åŠ¨åŒæ­¥å†å²æ•°æ®
ç«‹å³è§¦å‘ä¸€æ¬¡æ‰€æœ‰æŒä»“åŸºé‡‘çš„å†å²å‡€å€¼åŒæ­¥ä»»åŠ¡ï¼Œå¹¶æ ¹æ®æœ€æ–°å‡€å€¼æ ¡å‡†æŒä»“é‡‘é¢ã€‚
```bash
uv run cli sync-history
```

### å¯¼å…¥/å¯¼å‡ºæ•°æ®
å¤‡ä»½å’Œæ¢å¤æ ¸å¿ƒçš„æŒä»“æ•°æ®ï¼ˆä»£ç å’Œä»½é¢ï¼‰ã€‚
```bash
# å¯¼å‡ºæ‰€æœ‰æŒä»“åˆ° a_backup.json æ–‡ä»¶
uv run cli export-data -o a_backup.json

# ä» a_backup.json æ–‡ä»¶å¢é‡å¯¼å…¥æ•°æ®
uv run cli import-data a_backup.json

# è¦†ç›–å¼å¯¼å…¥ï¼ˆä¼šå…ˆåˆ é™¤æ‰€æœ‰æ—§æ•°æ®ï¼‰
uv run cli import-data a_backup.json --overwrite
```

---

## ğŸ³ ç”Ÿäº§ç¯å¢ƒ Docker éƒ¨ç½²

æˆ‘ä»¬ä½¿ç”¨ Docker å’Œ Docker Compose è¿›è¡Œç”Ÿäº§ç¯å¢ƒçš„éƒ¨ç½²ã€‚éƒ¨ç½²æµç¨‹åˆ†ä¸º**æ„å»ºé•œåƒ**å’Œ**è¿è¡Œå®¹å™¨**ä¸¤ä¸ªæ­¥éª¤ã€‚

### 1. ç¯å¢ƒå‡†å¤‡

-   **å®‰è£… Docker å’Œ Docker Compose**ã€‚
-   **å‡†å¤‡å¤–éƒ¨ Docker ç½‘ç»œ**: å¦‚æœç½‘ç»œä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»ºå®ƒï¼š
    ```bash
    docker network create shared-db-network
    ```
-   **å‡†å¤‡ç”Ÿäº§ç¯å¢ƒå˜é‡æ–‡ä»¶**: åˆ›å»º `.env.prod` æ–‡ä»¶ã€‚
    ```dotenv
    # .env.prod
    # æ³¨æ„ï¼šDATABASE_URL ä¸­çš„ä¸»æœºååº”ä¸ºæ•°æ®åº“å®¹å™¨åœ¨ Docker ç½‘ç»œä¸­çš„æœåŠ¡å
    DATABASE_URL="postgresql://prod_user:prod_password@postgres_container_name:5432/prod_db"
    DB_SCHEMA="fund_production"
    ```

### 2. æ„å»º Docker é•œåƒ (æ‰“åŒ…)

```bash
docker build -t fund-strategies-service:latest .
```

### 3. è¿è¡ŒæœåŠ¡ (Docker Compose)

å¯åŠ¨æœåŠ¡ï¼š
```bash
docker compose up -d
```

### 4. å¸¸ç”¨ Docker å‘½ä»¤

-   **æŸ¥çœ‹æœåŠ¡æ—¥å¿—**:
    ```bash
    docker compose logs -f fund_service
    ```
-   **åœæ­¢å¹¶ç§»é™¤å®¹å™¨**:
    ```bash
    docker compose down
    ```
-   **åœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œ CLI å‘½ä»¤**:
    ```bash
    docker compose exec fund_service cli sync-history
    ```

---

## ğŸ“„ License

MIT